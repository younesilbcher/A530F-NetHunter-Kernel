name: NetHunter Kernel Complete Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev \
          libgl1-mesa-dev libxml2-utils xsltproc unzip python3-pip ccache bc libssl-dev libelf-dev

      - name: Clone Toolchain
        run: |
          # تحميل أداة بناء Arter97 الموثوقة
          git clone --depth=1 https://github.com/arter97/arm64-gcc.git toolchain

      - name: Clone Kernel Source
        run: |
          # تحميل سورس Neternels المحدث
          git clone --depth=1 https://github.com/Neternels/Nethunter-Kernel-Exynos7885-Q-R-S.git kernel

      - name: Build Kernel
        run: |
          cd kernel
          export ARCH=arm64
          export CROSS_COMPILE=$GITHUB_WORKSPACE/toolchain/bin/aarch64-linux-gnu-
          
          # اختيار ملف الإعدادات الصحيح لسورس Neternels
          make O=out Neternels-a10_defconfig
          
          # حقن تعريفات وضع المراقبة (Monitor Mode) و HID
          scripts/config --file out/.config --enable CONFIG_WLAN
          scripts/config --file out/.config --enable CONFIG_MAC80211
          scripts/config --file out/.config --enable CONFIG_CFG80211
          scripts/config --file out/.config --enable CONFIG_USB_CONFIGFS_F_HID
          
          # بدء التجميع الفعلي
          make O=out -j$(nproc --all)

      - name: Package to Flashable ZIP
        run: |
          # جلب قالب AnyKernel3 لإنشاء ملف ZIP الذي طلبته
          git clone https://github.com/osm0sis/AnyKernel3.git
          cp kernel/out/arch/arm64/boot/Image.gz AnyKernel3/
          cd AnyKernel3
          # تعديل اسم الجهاز في السكربت لضمان التوافق
          sed -i 's/device.name1=/device.name1=jackpotlte/g' anykernel.sh
          zip -r../NetHunter-Kernel-A8-2018.zip *

      - name: Upload Flashable ZIP
        uses: actions/upload-artifact@v4
        with:
          name: NetHunter-ZIP-Final
          path: NetHunter-Kernel-A8-2018.zip
